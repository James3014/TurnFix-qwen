Feature: TurnFix 滑雪症狀診斷與練習建議系統

  作為滑雪愛好者
  我希望能夠輸入口語問題並獲得個性化練習建議
  以便改善我的滑行技術

  Scenario: 使用者輸入口語問題
    Given 使用者開啟應用程式
    When 使用者輸入 "轉彎會後坐"
    Then 系統應接收此輸入

  Scenario: 使用者輸入口語問題並選填資訊
    Given 使用者開啟應用程式
    When 使用者輸入 "轉彎會後坐" 並選填 等級為 "初級", 地形為 "綠線", 滑行風格為 "平花"
    Then 系統應接收此輸入及選填的資訊

  Rule: 症狀辨識
    系統應能將口語問題辨識為標準化症狀
    
    Example: 辨識標準化症狀
      Given 系統接收到使用者輸入 "轉彎會後坐"
      When 系統進行症狀辨識
      Then 系統應將其標準化為 "重心太後"

    Example: 辨識同義詞
      Given 系統接收到使用者輸入 "重心太後"
      When 系統進行症狀辨識
      Then 系統應將其標準化為 "重心太後"

    Example: 多個口語描述會對應到同一個標準症狀
      Given 使用者輸入 "轉彎不穩"
      When 系統進行症狀辨識
      Then 系統應將其標準化為 "重心太後"
      And 若置信度不足，系統應向使用者確認辨識結果

    Example: 納入裝備設定相關症狀的辨識
      Given 使用者輸入 "靴子太鬆導致後坐"
      When 系統進行症狀辨識
      Then 系統應將其標準化為 "靴子過鬆"
      And 症狀類別應為 "裝備"

    Example: 同義詞庫的動態擴充
      Given 管理者登入後台系統
      When 管理者新增 "轉彎卡卡" 為 "重心太後" 的同義詞
      Then 系統應更新同義詞庫
      And 使用者輸入 "轉彎卡卡" 時，系統應將其辨識為 "重心太後"

    Example: 置信度不足時提供多個可能症狀供選擇
      Given 系統接收到使用者輸入 "轉彎不穩"
      When 系統進行症狀辨識但置信度不足
      Then 系統應提供最可能的 2-3 個症狀選項
      And 使用者可從選項中選擇正確的症狀

  Rule: 自適應追問
    當系統對使用者輸入的症狀/條件置信度不足時，系統應進行追問
    
    Example: 置信度不足時進行追問
      Given 系統接收到使用者輸入 "轉彎會後坐"
      And 系統判斷症狀/條件置信度不足
      When 系統進行追問
      Then 系統應向使用者提出 1 到 2 個釐清問題

    Example: 置信度足夠時不追問
      Given 系統接收到使用者輸入 "轉彎會後坐"
      And 系統判斷症狀/條件置信度足夠
      When 系統進行追問
      Then 系統不應向使用者提出任何問題

    Example: 判斷「症狀/條件置信度不足」的標準
      Given 系統接收到使用者輸入 "轉彎不順"
      And 模型的預測機率分數低於 0.7
      And 系統辨識出多個可能性接近的「症狀種子」
      And 使用者輸入的問題過於簡短
      And 缺少必要的等級資訊
      When 系統判斷置信度
      Then 系統應判斷為「置信度不足」

    Example: 追問問題的來源
      Given 系統判斷為「置信度不足」
      And 系統有一個通用的追問問題庫
      And 缺少使用者等級資訊
      When 系統生成追問問題
      Then 系統應從通用問題庫中選取問題
      And 系統應根據缺失的等級資訊動態生成問題
      And 系統應向使用者提出 1 到 2 個追問問題

    Example: 通用問題庫的維護與擴充
      Given 系統需要維護和擴充追問問題庫
      When 系統需要增加新的追問問題
      Then 系統應結合管理員手動維護與AI學習使用者反饋的方式進行問題庫的維護與擴充

  Rule: 建議生成
    系統應能根據辨識出的症狀生成 3-5 張練習卡
    
    Example: 根據症狀生成練習卡
      Given 系統已辨識出標準化症狀 "重心太後"
      When 系統生成練習建議
      Then 系統應回傳 3 到 5 張練習卡

    Example: 根據條件過濾練習卡
      Given 系統已辨識出標準化症狀 "重心太後"
      And 使用者選填等級為 "初級", 地形為 "綠線"
      When 系統生成練習建議
      Then 系統應回傳 3 到 5 張符合 "初級" 和 "綠線" 條件的練習卡

    Example: 練習卡的選擇標準結合關聯性分數與使用者條件
      Given 系統已辨識出標準化症狀 "重心太後"
      And 使用者選填等級為 "初級", 地形為 "綠線"
      When 系統生成練習建議
      Then 系統應根據預定義的關聯性分數排序，並結合使用者等級和地形條件，選取 3 到 5 張練習卡

    Example: 練習卡的排序規則
      Given 系統已選取多張練習卡
      When 系統對練習卡進行排序
      Then 系統應根據使用者條件（等級、地形、風格）優先排序，再考慮關聯性分數

    Example: 處理練習卡數量不足 3 張的情況
      Given 系統已辨識出標準化症狀 "重心太後"
      And 只有 2 張練習卡符合條件
      When 系統生成練習建議
      Then 系統應回傳 2 張練習卡
      And 系統應提示練習卡數量不足

    Example: 處理練習卡數量超過 5 張的情況
      Given 系統已辨識出標準化症狀 "重心太後"
      And 有 6 張練習卡符合條件
      When 系統生成練習建議
      Then 系統應回傳 5 張練習卡
      And 系統應根據排序規則選取前 5 張

  Rule: 使用者回饋
    系統應能收集使用者對建議的評分和自由文字回饋
    
    Example: 收集使用者評分回饋
      Given 系統已提供練習卡
      When 使用者給予評分 "👍"
      Then 系統應記錄此回饋評分

    Example: 收集使用者自由文字回饋
      Given 系統已提供練習卡
      When 使用者輸入自由文字回饋 "這些練習很有用，但希望能有更多進階選項"
      Then 系統應記錄此自由文字回饋