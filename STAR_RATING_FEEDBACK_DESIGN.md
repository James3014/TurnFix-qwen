# 星數回饋設計文檔 - 個別練習卡評價系統

**更新日期**：2025-10-28
**版本**：v2.0 (Star Rating Implementation)
**優先級**：中（提升用戶體驗和資料品質）

---

## 📋 設計概述

### 雙層回饋架構

| 回饋層級 | 評價對象 | 評分方式 | 時機 | 用途 |
|---------|---------|---------|------|------|
| **層一** | 整個推薦流程 | ❌/△/✓ 三選項 | 即時或延遲 | 評估推薦系統的整體效果 |
| **層二** | 單個練習卡 | ⭐ 星數（1-5） | 隨時 | 評估個別練習卡的實用程度 |

---

## 🌟 層二設計詳解：星數評分系統

### 星數含義與應用場景

#### **1 顆星 ⭐ - 不適用**
**含義**：練習卡與我的症狀無關或完全不適合我
**何時選擇**：
- 練習描述的症狀與我遇到的問題不符
- 練習難度遠高於或低於我的等級
- 我已完全掌握此技能，無需練習
- 練習方法與我的滑行風格不相容

**系統優化方向**：
- 檢查症狀辨識邏輯是否有誤
- 檢查該練習卡的難度評級是否準確
- 考慮調整 SymptomPracticeMapping 的關聯性分數

---

#### **2 顆星 ⭐⭐ - 較不適用**
**含義**：練習卡的部分內容有用，但大多數內容不符合我的需求
**何時選擇**：
- 練習卡涵蓋多個主題，只有其中 1-2 個相關
- 練習的初級步驟有幫助，但進階部分不適用
- 練習方向基本正確，但執行方式不太符合我的習慣
- 有有用的背景知識，但練習本體不太相關

**系統優化方向**：
- 考慮拆分此練習卡成多個專注於單一主題的卡片
- 增加難度等級分化（初級/中級/高級變體）

---

#### **3 顆星 ⭐⭐⭐ - 部分適用**
**含義**：練習卡有幫助，但需要調整、補充或搭配其他資源才更有效
**何時選擇**：
- 練習卡解決了我的問題，但步驟可以更詳細或更簡化
- 建議的次數/時長不太適合我的訓練節奏
- 希望有更多背景理論或科學解釋
- 練習有效果，但配合其他練習效果更好
- 核心內容正確，但需要針對我的特定情況調整

**系統優化方向**：
- 標記「待改進」狀態
- 根據反饋文字提取改進建議
- 在練習卡旁增加補充資源連結
- 建議相關練習卡組合

---

#### **4 顆星 ⭐⭐⭐⭐ - 適用**
**含義**：練習卡相當有幫助，大部分內容符合我的需求
**何時選擇**：
- 練習卡準確識別了我的主要症狀
- 步驟清晰易懂，執行起來流暢
- 建議的強度和次數基本合適
- 實踐後感到明顯改進

**系統優化方向**：
- 保留此練習卡供其他用戶使用
- 提升其在搜尋結果中的排序位置
- 在類似症狀推薦時優先考慮

---

#### **5 顆星 ⭐⭐⭐⭐⭐ - 非常適用**
**含義**：練習卡完全符合我的需求，非常有幫助
**何時選擇**：
- 練習卡準確識別了我的症狀且提供了有效的解決方案
- 步驟清晰易懂，邏輯連貫，易於遵循
- 建議的強度、次數和時長恰到好處
- 實踐後明顯感受到顯著改進
- 願意向其他遇到類似問題的人推薦此練習

**系統優化方向**：
- 標記為「高品質練習卡」
- 在搜尋結果中優先排序
- 推薦自動加入用戶的最愛清單（提示用戶確認）
- 作為「示範卡片」供教練和系統開發者參考

---

## 🎯 星數與收藏（最愛）的獨立性

### 核心概念

**星數 ≠ 收藏**

用戶可以獨立地給予星數和設定收藏狀態：

| 星數 | 收藏 | 含義 | 使用場景 |
|------|------|------|---------|
| 5★ | ✓ | 完全符合需求，常用 | 日常練習的最愛卡片 |
| 5★ | ✗ | 完全符合，但不需常用 | 保存備用，但目前用不著 |
| 3★ | ✓ | 部分適用，但想保留 | 有潛力的卡片，想定期回顧改進 |
| 3★ | ✗ | 部分適用，暫不需要 | 實驗性卡片，效果不確定 |
| 1★ | ✓ | 不適用，但想跟蹤原因 | 預留作為反面教材或系統診斷 |
| 1★ | ✗ | 不適用 | 正常情況，系統會學習避免推薦 |

### 用戶流程

#### **評分之後追加收藏**
```
使用者給出星數 → 可立即點擊 ❤️ 按鈕加入最愛
或
稍後在練習卡清單中點擊 ❤️ 加入最愛（無需重新評分）
```

#### **更新星數（無需重新加入最愛）**
```
已加入最愛的練習卡 (5★ ❤️) → 使用者點擊修改評分 → 改為 3★
→ 最愛狀態保留，但星數已更新
```

---

## 📊 API 設計

### 端點一：提交練習卡評分

**POST `/api/v1/practice-cards/{practice_id}/feedback`**

```json
// 請求
{
  "session_id": 123,
  "rating": 4,                    // 必須：1-5 整數
  "feedback_text": "步驟清晰易懂，練習效果不錯，但希望能有影片示範"
}

// 回應
{
  "success": true,
  "message": "感謝您的評分！",
  "feedback_id": 456,
  "rating": 4,
  "created_at": "2025-10-28T14:30:00Z",
  "suggest_favorite": false  // 提示：如果評分 >= 4，可建議加入最愛
}
```

### 端點二：管理收藏狀態

**POST `/api/v1/practice-cards/{practice_id}/favorite`**

```json
// 請求 - 加入最愛
{
  "action": "add"  // 或 "remove"
}

// 回應
{
  "success": true,
  "practice_id": 123,
  "is_favorite": true,
  "current_rating": 4,  // 返回當前星數（如果有評分的話）
  "updated_at": "2025-10-28T14:35:00Z"
}
```

### 端點三：更新星數（已有評分）

**PUT `/api/v1/practice-cards/{practice_id}/feedback`**

```json
// 請求 - 修改已存在的評分
{
  "rating": 5,
  "feedback_text": "重新練習後發現更多優點，提升評分"
}

// 回應
{
  "success": true,
  "feedback_id": 456,
  "old_rating": 4,
  "new_rating": 5,
  "is_favorite": true,  // 保留原收藏狀態
  "updated_at": "2025-10-28T14:40:00Z"
}
```

### 端點四：獲取練習卡詳情及回饋狀態

**GET `/api/v1/practice-cards/{practice_id}`**

```json
// 回應
{
  "id": 123,
  "name": "平衡身體重心的基礎練習",
  "goal": "...",
  "tips": [...],
  "feedback_stats": {
    "average_rating": 4.2,  // 所有用戶的平均星數
    "total_ratings": 156,
    "rating_distribution": {
      "1": 12,
      "2": 8,
      "3": 28,
      "4": 62,
      "5": 46
    }
  },
  "user_feedback": {
    "session_id": 123,
    "rating": 4,
    "feedback_text": "步驟清晰易懂...",
    "is_favorite": true,
    "created_at": "2025-10-28T14:30:00Z"
  }  // 如果該用戶有評分；否則為 null
}
```

---

## 🎨 UI 設計

### UI-307.2：練習卡詳情頁 - 評分界面

```
┌─────────────────────────────────────┐
│  練習卡標題：平衡身體重心的基礎練習  │
│                                     │
│  📌 練習目標、要點、常見錯誤等...   │
│                                     │
├─────────────────────────────────────┤
│  這個練習對你有幫助嗎？              │
│                                     │
│  [⭐] [⭐⭐] [⭐⭐⭐] [⭐⭐⭐⭐] [⭐⭐⭐⭐⭐]
│                                     │
│  你的評分：4 顆星 ⭐⭐⭐⭐          │
│  幫助：適用 - 相當有幫助             │
│                                     │
│  ❤️ 加入最愛練習清單                │
│                                     │
│  你有其他建議嗎？（可選）           │
│  [文字輸入框...........................] │
│                                     │
│              [提交評分]              │
│              [返回練習清單]          │
└─────────────────────────────────────┘
```

### UI-309：最愛練習清單頁

```
┌─────────────────────────────────────┐
│        我的最愛練習清單               │
│                                     │
│  已保存 8 項練習                    │
├─────────────────────────────────────┤
│                                     │
│  ✓ 平衡身體重心的基礎練習   ⭐⭐⭐⭐⭐
│    上次練習：3 天前                 │
│    我的評分：5 顆星 / 非常適用       │
│    [開始練習]  [移除]               │
│                                     │
│  ✓ 髖關節靈活性訓練        ⭐⭐⭐⭐
│    上次練習：1 周前                 │
│    我的評分：4 顆星 / 適用          │
│    [開始練習]  [移除]               │
│                                     │
│  ... (更多最愛卡片)                 │
│                                     │
└─────────────────────────────────────┘
```

---

## 🔄 數據分析與優化

### 系統如何利用星數反饋

#### **高品質卡片（4-5 顆星）**
- ✅ 保留並優先推薦
- ✅ 在相似症狀推薦時排序靠前
- ✅ 可作為「示範卡片」在後台展示

#### **需要改進的卡片（3 顆星）**
- 🔧 標記「待改進」
- 🔧 自動收集改進建議（從 feedback_text）
- 🔧 推薦相關補充資源
- 🔧 考慮修訂內容或提供補充教材

#### **問題卡片（1-2 顆星）**
- 🚨 檢查症狀辨識邏輯
- 🚨 驗證難度評級是否準確
- 🚨 檢查是否應該針對不同症狀
- 🚨 考慮重寫或下架

### 管理後台儀表板

```
練習卡反饋分析
─────────────────────────────────────

平衡身體重心的基礎練習 (ID: 123)
├─ 平均星數：4.2 / 5.0 ⭐⭐⭐⭐
├─ 評分總數：156 次
├─ 評分分布：
│  ⭐      (12 次，7.7%)  ████░░░░░░
│  ⭐⭐    (8 次，5.1%)   ███░░░░░░░
│  ⭐⭐⭐  (28 次，17.9%) ████████░░░░░░░░
│  ⭐⭐⭐⭐  (62 次，39.7%) ████████████████████░░░░░
│  ⭐⭐⭐⭐⭐ (46 次，29.5%) █████████████████████████░
│
├─ 最愛次數：89 次 ❤️ (57% 的評分用戶)
├─ 建議改進次數：12 次 (7.7% 反映問題)
│
└─ 推薦行動：
   ✓ 保留並優先推薦
   ✓ 檢查 3★ 反饋的常見建議
   ✓ 考慮錄製補充視頻
```

---

## 🔧 實作清單

### 資料庫層
- [ ] 更新 `PracticeCardFeedback` 表的 `rating` 欄位（INT 1-5 替代 VARCHAR）
- [ ] 遷移現有資料（如有）：`'applicable'` → 5, `'partially_applicable'` → 3, `'not_applicable'` → 1
- [ ] 確保 `is_favorite` 欄位獨立於 `rating`

### API 層
- [ ] 實現 POST `/api/v1/practice-cards/{id}/feedback` 星數評分端點
- [ ] 實現 PUT `/api/v1/practice-cards/{id}/feedback` 修改星數端點
- [ ] 實現 POST `/api/v1/practice-cards/{id}/favorite` 收藏管理端點
- [ ] 更新 GET `/api/v1/practice-cards/{id}` 包含星數統計和用戶評分
- [ ] 實現後台儀表板 API 端點（GET `/api/v1/admin/feedback-analytics/{practice_id}`）

### UI 層
- [ ] 更新 UI-307.2 評分界面顯示 5 個星數按鈕
- [ ] 實現星數按鈕的交互反饋（懸停、選中、樣式變化）
- [ ] 實現❤️按鈕用於加入/移除最愛（獨立於星數）
- [ ] 實現星數修改流程（無需重新提交全部數據）
- [ ] 更新 UI-309 最愛清單頁顯示星數和上次練習時間
- [ ] 實現最愛清單的移除功能

### 分析層
- [ ] 在管理後台添加回饋分析儀表板
- [ ] 顯示平均星數、評分分布、最愛次數
- [ ] 實現自動建議（基於 3★ 和 1★ 反饋的模式分析）
- [ ] 生成改進優先級報告

---

## ✅ 驗收標準

- [ ] 資料庫支援 1-5 星數值域
- [ ] API 正確驗證星數 (1-5) 和收藏狀態
- [ ] UI 清晰顯示 5 個星數按鈕，點擊有視覺反饋
- [ ] 用戶可獨立修改星數（不影響收藏狀態）
- [ ] 用戶可獨立加入/移除最愛（不影響星數）
- [ ] 自由文字反饋保留且可選填
- [ ] 管理後台顯示星數分布統計
- [ ] 舊資料正確遷移

---

## 📝 使用者指引文案

### 評分頁面提示文字

```
這個練習對你有幫助嗎？

評分說明：
⭐        = 不適用 (練習與我的症狀無關)
⭐⭐      = 較不適用 (部分內容有用)
⭐⭐⭐    = 部分適用 (有幫助但需要調整)
⭐⭐⭐⭐  = 適用 (相當有幫助)
⭐⭐⭐⭐⭐ = 非常適用 (完全符合我的需求)
```

### 收藏功能提示

```
❤️ 加入最愛練習清單

將常用或最有效的練習保存在一個地方，
下次需要時可以快速找到。

提示：你可以收藏任何星數的練習。
例如：保留 3★ 卡片作為「待改進」清單進行定期回顧。
```

---

**版本**：v2.0 (Star Rating)
**最後更新**：2025-10-28
