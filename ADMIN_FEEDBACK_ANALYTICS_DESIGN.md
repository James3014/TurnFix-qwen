# 管理後台回饋分析系統設計文檔

**更新日期**：2025-10-28
**版本**：v1.0 (Admin Analytics)
**用途**：幫助管理員理解用戶反饋、識別問題、優化推薦系統

---

## 📋 系統概述

### 核心目標

管理後台提供三層分析視角：

```
層級一：整體概覽 (Dashboard)
  ↓
層級二：對象深度分析 (練習卡 / 症狀 / 用戶偏好)
  ↓
層級三：詳細數據與導出 (CSV / Excel / PDF)
```

---

## 🎯 管理後台分析模塊 (UI-308.6 - UI-308.10)

### UI-308.6：回饋分析儀表板 (主頁)

#### A. 層一分析區塊 (Session Level)

```
┌──────────────────────────────────────────┐
│  推薦流程效果評分                        │
├──────────────────────────────────────────┤
│                                          │
│  評分分布                                │
│  ❌ 不適用: 12  (8.1%)  ████░░░░░░░    │
│  △ 部分適用: 45 (30.4%) ████████████░░ │
│  ✓ 適用: 78    (52.7%) ██████████████░ │
│  (無評分: 48,  32.4%)                   │
│                                          │
│  評分完成率: 67.6%  (135 / 199)          │
│                                          │
│  即時 vs 延遲                            │
│  ├─ 即時回饋: 80 (59.3%)                │
│  └─ 延遲回饋: 55 (40.7%)                │
│                                          │
│  過去 7 天趨勢 (折線圖)                  │
│    評分數
│    60 │     ╱╲                          │
│    50 │    ╱  ╲                         │
│    40 │   ╱    ╲╱╲                      │
│    30 │──────────  ──                   │
│       └─────────────────                │
│        Mon Tue Wed Thu Fri Sat Sun      │
│                                          │
└──────────────────────────────────────────┘
```

#### B. 層二分析區塊 (PracticeCard Level)

```
┌──────────────────────────────────────────┐
│  練習卡評分分析                          │
├──────────────────────────────────────────┤
│                                          │
│  整體星數分布                            │
│  1★ (不適用):     10  (6.7%)  ████░    │
│  2★ (較不適用):   15 (10.1%)  ████░░   │
│  3★ (部分適用):   45 (30.4%)  ████████ │
│  4★ (適用):       58 (39.2%)  ████████ │
│  5★ (非常適用):   23 (15.5%)  ███░     │
│                                          │
│  平均星數: 3.45 / 5.0 ⭐⭐⭐           │
│  評分次數: 148 次                        │
│  最愛次數: 47 次 (31.8%)                │
│                                          │
│  Top 5 最高評分卡片:                    │
│  1. 平衡身體重心 (avg: 4.6★, 28 評分) │
│  2. 轉彎技巧基礎 (avg: 4.4★, 22 評分) │
│  3. 髖關節靈活性 (avg: 4.2★, 19 評分) │
│  4. 下坡速度控制 (avg: 4.1★, 25 評分) │
│  5. 初級平衡練習 (avg: 4.0★, 31 評分) │
│                                          │
└──────────────────────────────────────────┘
```

#### C. 對比分析區塊

```
┌──────────────────────────────────────────┐
│  相關性分析                              │
├──────────────────────────────────────────┤
│                                          │
│  層一評分 ↔ 層二星數相關性               │
│  相關係數 (Pearson): 0.73 (強正相關)    │
│  ✓ 適用的會話 → 平均卡片星數 3.9★     │
│  △ 部分適用 → 平均卡片星數 3.2★       │
│  ❌ 不適用的會話 → 平均卡片星數 2.1★   │
│                                          │
│  結論：層一評分能有效反映層二體驗       │
│                                          │
│  用戶流漏分析                            │
│  推薦給用戶: 199 次                      │
│  → 評分的用戶: 135 次 (67.8%)           │
│  → 未評分: 64 次 (32.2%)                │
│  → 加入最愛: 47 次 (34.8% of 135)      │
│                                          │
│  建議：提升評分完成率 (目標 80%+)       │
│                                          │
└──────────────────────────────────────────┘
```

#### D. 快速操作菜單

```
[🔍 深入分析練習卡]  [📊 症狀有效性]  [👥 用戶偏好]
[📥 導出數據]        [⚙️ 篩選設定]    [刷新]
```

---

### UI-308.7：練習卡回饋詳情頁

**URL**: `/admin/analytics/practice-cards/{id}`

#### A. 基本信息區塊

```
┌──────────────────────────────────────────┐
│  練習卡: 平衡身體重心的基礎練習 (ID: 123)│
│  建立時間: 2025-09-15                    │
│  關聯症狀: 後坐, 重心不穩                │
├──────────────────────────────────────────┤
│                                          │
│  評分統計                                │
│  ├─ 平均星數: 4.6 / 5.0 ⭐⭐⭐⭐⭐   │
│  ├─ 評分總數: 28 次                     │
│  ├─ 最愛次數: 18 次 (64.3%)             │
│  └─ 上次評分: 2 天前                    │
│                                          │
└──────────────────────────────────────────┘
```

#### B. 星數分布圖表 (柱狀圖)

```
星數分布
評分數
 10 │                 ██
  8 │    ██           ██
  6 │    ██    ██     ██
  4 │    ██    ██     ██
  2 │ ██ ██ ██ ██ ██  ██
  0 └──────────────────────
     1★  2★  3★  4★  5★

分布明細:
1★: 1 次   (3.6%)  ███░░░░░░░
2★: 2 次   (7.1%)  ██░░░░░░░░
3★: 3 次  (10.7%)  ███░░░░░░░
4★: 6 次  (21.4%)  ████████░░
5★: 16 次 (57.1%)  █████████
```

#### C. 時間趨勢圖 (過去 30 天)

```
星數趨勢 (過去 30 天)
星數
 5 │    ╱╲  ╱╲
 4 │   ╱  ╲╱  ╲╱╲
 3 │──────────── ──
   └──────────────────
    D1 D5 D10 D15 D20 D25 D30

平均星數: 4.6
評分數量: 28
最愛比例: 64% → 趨勢: ↑ (上升)
```

#### D. 用戶反饋文本摘要

```
常見反饋詞彙 (Tag Cloud):
  ★★★ 清晰易懂      ★★★ 效果不錯
  ★★ 步驟詳細       ★★ 很有幫助
  ★ 推薦給朋友      ★ 基礎必學

用戶反饋摘錄:
─────────────────────────────
✓ "步驟清晰易懂，練習效果明顯。" (5★)
✓ "很有幫助，建議配合影片示範。" (4★)
✓ "基礎練習必學，強烈推薦。" (5★)
✓ "內容好，但希望有更多進階版本。" (4★)
─────────────────────────────
```

#### E. 改進建議清單

```
🚨 改進建議 (基於低評分 1-2★ 的反饋)

#1 需要更詳細的步驟說明 (2 次提及)
   ├─ 用戶反饋: "步驟太快，新手容易困惑"
   ├─ 建議行動: 添加分解動作或逐步圖示
   └─ 預期效果: 可能提升 0.3-0.5★

#2 需要影片示範 (1 次提及)
   ├─ 用戶反饋: "看不懂怎麼做，希望有影片"
   ├─ 建議行動: 錄製練習卡的示範視頻
   └─ 預期效果: 可能提升 0.4-0.6★

#3 難度設定不適合初學者 (1 次提及)
   ├─ 用戶反饋: "感覺有點難，適合中級以上"
   ├─ 建議行動: 創建簡化版本 或 重新分類難度
   └─ 預期效果: 針對初級用戶可能提升 0.5-0.8★
```

#### F. 最近評分記錄

```
最近 10 個評分記錄:

時間       用戶   星數 最愛  反饋內容
─────────────────────────────────────
2025-10-28 User#1 5★  ❤️   "完美！"
2025-10-27 User#2 4★      "步驟太快"
2025-10-26 User#3 5★  ❤️   "非常有幫助"
2025-10-25 User#4 3★      "部分有用"
2025-10-24 User#5 5★  ❤️   "推薦給朋友"
...

[查看所有評分] [導出本卡片評分記錄]
```

#### G. 操作按鈕

```
[📝 編輯練習卡]  [➕ 創建改進版本]  [📊 導出分析報告]  [返回]
```

---

### UI-308.8：症狀回饋分析頁

**URL**: `/admin/analytics/symptoms/{id}`

#### A. 症狀信息與推薦效果

```
┌──────────────────────────────────────────┐
│  症狀: 後坐 (ID: 15, 分類: 技術)        │
│  同義詞: 坐得太後面, 重心過後            │
├──────────────────────────────────────────┤
│                                          │
│  推薦效果評分 (層一)                    │
│  ✓ 適用:      18 (60%) ██████████░     │
│  △ 部分適用:  9  (30%) ██████░░░░     │
│  ❌ 不適用:    3  (10%) ██░░░░░░░░     │
│  無評分:      15 (33%)                  │
│                                          │
│  推薦有效率: 60% (適用 / 已評分人數)   │
│  推薦完成率: 67% (已評分 / 總推薦)     │
│                                          │
└──────────────────────────────────────────┘
```

#### B. 關聯練習卡分析

```
關聯練習卡效能評估 (5 張):

練習卡名稱             平均星數  評分數  最愛率  有效性 狀態
──────────────────────────────────────────────────────────
1. 平衡身體重心        4.6★    28    64%  92%   ✓ 優秀
2. 髖關節靈活性        4.2★    19    58%  84%   ✓ 優秀
3. 腳踝穩定性訓練      3.8★    15    40%  67%   △ 良好
4. 初級平衡練習        3.2★    12    33%  50%   △ 需改進
5. 下坡技巧基礎        2.9★    8     13%  25%   ❌ 問題卡

高效卡片 (平均 4★+ 且最愛率 > 50%):
  ✓ 平衡身體重心 (4.6★, 64% 最愛率)
  ✓ 髖關節靈活性 (4.2★, 58% 最愛率)

問題卡片 (平均 < 2★ 或最愛率 < 10%):
  ❌ 下坡技巧基礎 (2.9★, 13% 最愛率)
     └─ 建議: 重新撰寫 或 分拆成多個卡片
```

#### C. 推薦趨勢分析 (過去 30 天)

```
推薦有效率趨勢 (過去 30 天)
有效率
  80% │   ╱╲
  60% │  ╱  ╲╱╲
  40% │ ╱      ╲
  20% │────────  ──
    0%└──────────────
       D1 D5 D10 D15 D20 D25 D30

平均有效率: 60%
推薦次數: 45 次
評分次數: 30 次
趨勢: ↓ (下降) - 可能需要優化卡片內容

[詳細數據] [導出本症狀分析]
```

---

### UI-308.9：用戶偏好分析頁

**URL**: `/admin/analytics/user-preferences`

#### A. 整體評分排名

```
┌──────────────────────────────────────────┐
│  Top 20 最高評分練習卡                  │
├──────────────────────────────────────────┤
│                                          │
│ # 練習卡名稱             平均星數 評分數  │
│────────────────────────────────────────│
│ 1  平衡身體重心         4.6★    28     │
│ 2  轉彎技巧基礎         4.4★    22     │
│ 3  髖關節靈活性         4.2★    19     │
│ 4  下坡速度控制         4.1★    25     │
│ 5  初級平衡練習         4.0★    31     │
│ ... (15 more)                          │
│                                          │
│ Top 20 最常被加入最愛的練習卡          │
│ # 練習卡名稱             最愛次數 評分數 │
│────────────────────────────────────────│
│ 1  平衡身體重心         18      28     │
│ 2  轉彎技巧基礎         14      22     │
│ 3  髖關節靈活性         11      19     │
│ ... (17 more)                          │
│                                          │
└──────────────────────────────────────────┘
```

#### B. 用戶段落分析

```
按使用者等級分析:

🟢 初級使用者 (100 人)
├─ 平均評分: 3.6★ / 5.0
├─ 最愛率: 28%
├─ 最喜歡的卡片: 初級平衡練習 (avg 4.2★)
└─ 建議: 增加初級難度的卡片

🟡 中級使用者 (150 人)
├─ 平均評分: 3.9★ / 5.0
├─ 最愛率: 35%
├─ 最喜歡的卡片: 平衡身體重心 (avg 4.6★)
└─ 建議: 保持當前卡片品質

🔴 進階使用者 (50 人)
├─ 平均評分: 4.1★ / 5.0
├─ 最愛率: 42%
├─ 最喜歡的卡片: 高級轉彎技巧 (avg 4.5★)
└─ 建議: 增加進階練習內容
```

#### C. 地形偏好分析

```
按滑行地形分析:

雪道 (藍色道) - 100 次推薦
├─ 完成率: 68%
├─ 平均星數: 3.7★
├─ 最愛率: 28%
└─ 推薦卡片: 基礎轉彎 (4.2★), 速度控制 (3.9★)

紅色道 - 85 次推薦
├─ 完成率: 72%
├─ 平均星數: 3.9★
├─ 最愛率: 35%
└─ 推薦卡片: 平衡身體重心 (4.6★), 短轉技巧 (4.0★)

黑色道 - 40 次推薦
├─ 完成率: 75%
├─ 平均星數: 4.1★
├─ 最愛率: 42%
└─ 推薦卡片: 高級技巧 (4.3★), 高速控制 (4.2★)

💡 洞察：地形越高級，用戶滿意度越高
```

#### D. 滑行風格偏好

```
按滑行風格分析:

⛷️ 傳統滑雪 - 120 次推薦
├─ 平均星數: 3.8★
└─ 最愛卡片: 平衡與轉彎系列

🏂 單板滑雪 - 95 次推薦
├─ 平均星數: 4.0★
└─ 最愛卡片: 邊刃控制、跳躍技巧系列
```

---

### UI-308.10：數據導出與報告

**URL**: `/admin/analytics/export`

#### 導出界面

```
┌──────────────────────────────────────────┐
│         導出分析數據與報告               │
├──────────────────────────────────────────┤
│                                          │
│  報告類型:                               │
│  ○ 整體統計摘要        ○ 練習卡詳情     │
│  ○ 症狀有效性分析      ○ 用戶偏好分析  │
│  ○ 完整數據轉儲                         │
│                                          │
│  時間範圍:                               │
│  開始日期: [2025-10-01] 📅              │
│  結束日期: [2025-10-28] 📅              │
│                                          │
│  篩選條件 (可選):                        │
│  ☑️ 特定症狀: [選擇症狀...]              │
│  ☑️ 特定卡片: [選擇卡片...]              │
│  ☐ 星數範圍: [1] 至 [5]                │
│  ☐ 回饋類型: [即時/延遲/全部]           │
│                                          │
│  格式選擇:                               │
│  ○ CSV (用於 Excel)                     │
│  ○ Excel (.xlsx)                        │
│  ○ PDF 報告 (含圖表)                    │
│  ○ JSON (用於進一步分析)                │
│                                          │
│  內容選項:                               │
│  ☑️ 包含用戶反饋文本                     │
│  ☑️ 包含統計圖表                        │
│  ☑️ 包含改進建議                        │
│  ☐ 匿名化用戶信息                       │
│                                          │
│              [導出]  [預覽]  [取消]     │
│                                          │
└──────────────────────────────────────────┘
```

#### 預設報告模板

```
預設報告:

□ 週報 (自動生成每週一上午 9:00)
  ├─ 過去 7 天整體統計
  ├─ 星數變化趨勢
  ├─ Top 5 最高評分卡片
  └─ 需改進卡片清單

□ 月報 (自動生成每月 1 日)
  ├─ 過去 30 天完整分析
  ├─ 用戶段落分析
  ├─ 地形/風格偏好分析
  └─ 改進優先級排序

□ 季報 (自動生成每季開始)
  ├─ 90 天完整數據
  ├─ 系統性能評估
  ├─ 用戶滿意度趨勢
  └─ 策略建議
```

---

## 🔌 API 設計詳解 (API-207)

### API-207.1: 整體統計摘要

```bash
GET /api/v1/admin/feedback-analytics/summary?days=30

Response:
{
  "period": {
    "start_date": "2025-09-28",
    "end_date": "2025-10-28",
    "days": 30
  },
  "session_feedback": {
    "distribution": {
      "not_applicable": 12,
      "partially_applicable": 45,
      "applicable": 78
    },
    "completion_rate": 0.676,
    "immediate_vs_delayed": {
      "immediate": 80,
      "delayed": 55
    },
    "trend_7d": [15, 18, 22, 19, 25, 28, 21]
  },
  "practice_card_feedback": {
    "distribution": {
      "1": 10, "2": 15, "3": 45, "4": 78, "5": 52
    },
    "average_rating": 3.45,
    "total_ratings": 200,
    "favorite_count": 64,
    "favorite_rate": 0.32
  },
  "correlation": {
    "pearson": 0.73,
    "interpretation": "strong_positive"
  },
  "top_cards_by_rating": [
    {
      "id": 123,
      "name": "平衡身體重心",
      "avg_rating": 4.6,
      "rating_count": 28
    },
    ...
  ]
}
```

### API-207.2: 練習卡詳細分析

```bash
GET /api/v1/admin/feedback-analytics/practice-cards/123?days=30

Response:
{
  "card_info": {
    "id": 123,
    "name": "平衡身體重心的基礎練習",
    "created_at": "2025-09-15"
  },
  "rating_distribution": {
    "1": 1, "2": 2, "3": 3, "4": 6, "5": 16
  },
  "rating_stats": {
    "average": 4.6,
    "median": 5,
    "mode": 5,
    "std_dev": 0.75,
    "total_count": 28
  },
  "rating_trend": [
    { "date": "2025-10-28", "avg_rating": 4.7, "count": 2 },
    { "date": "2025-10-27", "avg_rating": 4.5, "count": 1 },
    ...
  ],
  "favorite_stats": {
    "count": 18,
    "rate": 0.643
  },
  "feedback_summary": {
    "top_keywords": ["清晰", "有幫助", "有效", "推薦"],
    "keyword_frequency": [12, 9, 8, 7]
  },
  "improvement_suggestions": [
    {
      "rank": 1,
      "issue": "需要更詳細的步驟說明",
      "frequency": 2,
      "sample_feedback": "步驟太快，新手容易困惑",
      "suggested_action": "添加分解動作或逐步圖示",
      "expected_impact": "可能提升 0.3-0.5★"
    }
  ],
  "recent_sessions": [
    {
      "session_id": 456,
      "user_level": "intermediate",
      "rating": 5,
      "is_favorite": true,
      "feedback_text": "完美！",
      "created_at": "2025-10-28T14:30:00Z"
    },
    ...
  ]
}
```

### API-207.3: 症狀回饋分析

```bash
GET /api/v1/admin/feedback-analytics/symptoms/15?days=30

Response:
{
  "symptom_info": {
    "id": 15,
    "name": "後坐",
    "category": "技術"
  },
  "session_feedback": {
    "distribution": {
      "not_applicable": 3,
      "partially_applicable": 9,
      "applicable": 18
    },
    "effectiveness_rate": 0.60
  },
  "related_cards_analysis": [
    {
      "practice_id": 123,
      "card_name": "平衡身體重心",
      "avg_rating": 4.6,
      "rating_count": 28,
      "favorite_count": 18,
      "favorite_rate": 0.643,
      "effectiveness_score": 0.92
    },
    ...
  ],
  "high_performers": [
    { "id": 123, "name": "平衡身體重心", "rating": 4.6 },
    { "id": 124, "name": "髖關節靈活性", "rating": 4.2 }
  ],
  "low_performers": [
    { "id": 126, "name": "下坡技巧基礎", "rating": 2.9 }
  ],
  "trend": [
    { "date": "2025-10-28", "effectiveness": 0.65, "recommendations": 3 },
    ...
  ]
}
```

### API-207.4: 用戶偏好分析

```bash
GET /api/v1/admin/feedback-analytics/user-preferences

Response:
{
  "top_rated_cards": [
    {
      "rank": 1,
      "id": 123,
      "name": "平衡身體重心",
      "avg_rating": 4.6,
      "rating_count": 28
    },
    ...
  ],
  "most_favorited_cards": [
    {
      "rank": 1,
      "id": 123,
      "name": "平衡身體重心",
      "favorite_count": 18,
      "total_ratings": 28
    },
    ...
  ],
  "user_segments": {
    "beginner": {
      "user_count": 100,
      "avg_rating": 3.6,
      "favorite_rate": 0.28,
      "top_cards": [
        { "id": 45, "name": "初級平衡練習", "avg_rating": 4.2 }
      ]
    },
    "intermediate": {
      "user_count": 150,
      "avg_rating": 3.9,
      "favorite_rate": 0.35,
      "top_cards": [...]
    },
    "advanced": {
      "user_count": 50,
      "avg_rating": 4.1,
      "favorite_rate": 0.42,
      "top_cards": [...]
    }
  },
  "terrain_preferences": {
    "blue": { "avg_rating": 3.7, "recommendations": 100 },
    "red": { "avg_rating": 3.9, "recommendations": 85 },
    "black": { "avg_rating": 4.1, "recommendations": 40 }
  },
  "style_preferences": {
    "traditional_ski": { "avg_rating": 3.8, "recommendations": 120 },
    "snowboard": { "avg_rating": 4.0, "recommendations": 95 }
  }
}
```

---

## 📊 數據驅動決策示例

### 案例一：高評分卡片 (4.6★)

**觀察**：練習卡平均 4.6★，64% 最愛率
**洞察**：這是高品質卡片，值得在推薦系統中提升優先級
**行動**：
- ✅ 保留並優先推薦
- ✅ 作為「示範卡片」供新教練參考
- ✅ 在相似症狀推薦中排序靠前

---

### 案例二：中等評分卡片 (3.2★)

**觀察**：平均星數 3.2★，改進建議多，最愛率只有 33%
**洞察**：卡片有潛力但需要改進
**行動**：
- 🔧 根據用戶反饋 (「步驟太快」) 修訂內容
- 🔧 添加補充資源 (影片、圖示)
- 📊 30 天後重新評估效果
- 預期：提升 0.5-0.8★

---

### 案例三：低評分卡片 (2.9★)

**觀察**：平均 2.9★，最愛率只有 13%，多個低星評分
**洞察**：卡片可能不符合用戶需求或難度定位不當
**行動**：
- ❌ 暫停在某些症狀的推薦
- 📝 重新撰寫或拆分成多個卡片
- 🎓 檢查難度是否應該重新分類
- 🗑️ 如果無法改進，考慮下架

---

### 案例四：推薦完成率低

**觀察**：推薦給 199 個用戶，只有 68% 評分
**洞察**：32% 的用戶沒有評分，系統反饋不足
**行動**：
- 📨 在推薦後 3 天提醒評分
- 🎯 簡化評分流程 (只需點擊星數)
- 🎁 考慮激勵機制 (如: 前 10 個評分者獲得獎勵)
- **目標**：提升至 80%+ 評分率

---

## 🎯 管理員工作流

### 日常檢查 (每天 5 分鐘)
1. 打開回饋分析儀表板 (UI-308.6)
2. 查看過去 24 小時的新評分
3. 檢查是否有新的低評分卡片 (1-2★)
4. 如有問題，進入卡片詳情頁深入分析

### 週期性優化 (每週 30 分鐘)
1. 導出週報 (UI-308.10)
2. 識別需要改進的卡片 (3★ 且最愛率 < 30%)
3. 聯絡教練修訂內容
4. 檢查用戶偏好變化 (UI-308.9)

### 月度策略 (每月 1 小時)
1. 導出月報，進行深度分析
2. 評估推薦系統的整體有效性
3. 計劃新卡片開發 (針對低評分症狀)
4. 審查數據遷移和改進執行

---

## ✅ 驗收標準

### UI 層
- [ ] UI-308.6: 儀表板顯示層一、層二、對比分析
- [ ] UI-308.7: 卡片詳情包含圖表、改進建議、反饋摘錄
- [ ] UI-308.8: 症狀分析顯示推薦有效性和高效/問題卡片
- [ ] UI-308.9: 用戶偏好分析支援多維度 (級別、地形、風格)
- [ ] UI-308.10: 數據導出支援多格式和預設報告

### API 層
- [ ] API-207.1: 整體統計API 返回完整數據 (層一、層二、對比)
- [ ] API-207.2: 卡片詳情 API 包含改進建議計算
- [ ] API-207.3: 症狀分析 API 識別高效/低效卡片
- [ ] API-207.4: 用戶偏好 API 支援多維度分析
- [ ] API-207.5: 篩選 API 支援時間、症狀、卡片、星數範圍篩選
- [ ] API-207.6: 導出 API 支援多格式 (CSV, Excel, PDF)

### 功能性
- [ ] 管理員可查看所有層一和層二反饋數據
- [ ] 可識別高品質、低品質、需要改進的卡片
- [ ] 可理解用戶偏好（級別、地形、風格差異）
- [ ] 可導出數據進行進一步分析
- [ ] 系統反饋完整率達 80%+

---

**版本**：v1.0
**最後更新**：2025-10-28
**下次審查**：上線後 2 周 (2025-11-15)
