# 專案實作任務清單 - TurnFix MVP

## 1. 資料庫層任務 (Database Layer Tasks)

-   [x] **DB-101**：根據 `spec/erm.dbml` 建立資料庫 schema。
-   [x] **DB-102**：為 `Symptom` 表格建立 `id`、`name`、`synonyms`、`level_scope`、`terrain_scope`、`style_scope`、`category` 欄位，並設定 `id` 為主鍵且必須 > 0。
-   [x] **DB-103**：為 `PracticeCard` 表格建立 `id`、`name`、`goal`、`tips`、`pitfalls`、`dosage`、`level`、`terrain`、`self_check`、`card_type` 欄位，並設定 `id` 為主鍵且必須 > 0。
-   [x] **DB-104**：為 `Session` 表格建立 `id`、`user_type`、`input_text`、`level_slot`、`terrain_slot`、`style_slot`、`chosen_symptom_id`、`feedback_rating`、`feedback_text` 欄位，並設定 `id` 為主鍵且 `chosen_symptom_id` 必須 > 0。
-   [x] **DB-105**：為 `SymptomPracticeMapping` 表格建立 `symptom_id`、`practice_id`、`order` 欄位，並設定外鍵關聯至 `Symptom.id` 和 `PracticeCard.id`，且 `symptom_id` 和 `practice_id` 必須 > 0。
-   [x] **DB-106**：確保資料庫 schema 支援每個症狀對應多張練習卡，但不強制執行 3-5 張的數量限制（由後端服務處理）。

## 2. 後端 API 層任務 (Backend API Layer Tasks)

-   [x] **API-201**：開發「症狀辨識」API。
    -   [x] **API-201.1**：實現口語問題到標準症狀的「多對一」映射邏輯。
    -   [x] **API-201.2**：實現同義詞庫的動態擴充機制。
-   [x] **API-202**：開發「建議生成」API。
    -   [x] **API-202.1**：根據關聯性分數和使用者條件（等級、地形、風格）選擇和排序練習卡。
    -   [x] **API-202.2**：處理練習卡數量不足 3 張時的邏輯（回傳所有符合的，併提示「找到 X 張練習卡，建議至少 3 張」）。
    -   [x] **API-202.3**：處理練習卡數量超過 5 張時的邏輯（根據排序規則選取前 5 張，併提示「共找到 X 張，已顯示排名前 5 張」）。
    -   [x] **API-202.4**：實作後端服務層驗證，確保每個症狀對應 3-5 張練習卡（用於 API-205.3 管理後台新增症狀↔練習卡關聯時）。
        - **驗證邏輯**：當管理者新增或編輯症狀的練習卡關聯時，檢查該症狀關聯的練習卡數量；若不足 3 張或超過 5 張，提示「建議關聯 3-5 張練習卡」但仍允許保存。
        - **不強制限制**：資料庫層不做外鍵約束，允許任意數量，這樣未來可以靈活調整。
-   [x] **API-203**：開發「自適應追問」API。
    -   [x] **API-203.1**：實現 LLM 輔助的置信度判斷（使用 AI 模型根據上下文判斷是否需要追問）。
        - **邏輯**：將使用者輸入、已辨識症狀、置信度分數、缺失 Slot 資訊作為 context 傳給 LLM；LLM 判斷是否需要追問（0-2 題），並生成追問問題。
        - **考慮因素**：症狀置信度 < 0.7、多個同義症狀的競爭、缺少關鍵 Slot（等級、地形）、使用者描述過於簡短（< 10 字）。
    -   [x] **API-203.2**：實現追問問題生成機制（結合通用問題庫和動態生成）。
        - **方式**：優先使用預定義的通用問題庫（針對常見缺失資訊），如果 LLM 判斷需要更細緻的追問則動態生成。
        - **回傳格式**：`{ "need_followup": bool, "questions": [{"question": "...", "type": "level|terrain|style|clarification"}] }`。
-   [x] **API-204**：開發「使用者回饋」API（分為兩層）。

    **回饋層一：Session 層級 - 整個問題推薦流程的效果評價**
    -   [x] **API-204.1**：提供接口記錄對整個推薦流程的評分 (`SessionFeedback`)。
        - **值域**：`"not_applicable"` (❌ 不適用) / `"partially_applicable"` (△ 部分適用) / `"applicable"` (✓ 適用)
        - **feedback_type**：`"immediate"` (即時) 或 `"delayed"` (延遲，練習後評價)
        - **含義**：這些推薦的練習卡是否幫助改善了我的問題？
    -   [x] **API-204.2**：提供接口記錄對整個推薦流程的自由文字評論。

    **回饋層二：PracticeCard 層級 - 單個練習卡的品質評價**
    -   [x] **API-204.3**：提供接口記錄對單個練習卡的星數評分 (`PracticeCardFeedback`)。
        - **星數值域**：1-5 顆星（整數）
          - **1 顆星** ⭐：不適用 - 練習卡與我的症狀無關或不適合我
          - **2 顆星** ⭐⭐：較不適用 - 有些內容有用，但大部分不適用
          - **3 顆星** ⭐⭐⭐：部分適用 - 有幫助但需要調整或補充
          - **4 顆星** ⭐⭐⭐⭐：適用 - 相當有幫助
          - **5 顆星** ⭐⭐⭐⭐⭐：非常適用 - 完全符合我的需求
        - **is_favorite**：布林值，是否加入最愛清單（預設 false），可獨立於星數設定
        - **含義**：這張練習卡本身對我的實用程度如何？
        - **時機**：隨時可評價（在查看練習卡時或完成練習後）
    -   [x] **API-204.4**：提供接口記錄對單個練習卡的自由文字評論（可選）。
    -   [x] **API-204.5**：提供接口支援更新 PracticeCardFeedback 的 `is_favorite` 狀態（加入/移除最愛），獨立於星數評分。
-   [x] **API-205**：開發「管理者後台」API。
    -   [x] **API-205.1**：提供 CRUD 接口用於管理症狀種子（Create, Read, Update, Delete）。
    -   [x] **API-205.2**：提供 CRUD 接口用於管理練習卡（Create, Read, Update, Delete）。
    -   [x] **API-205.3**：提供接口管理症狀↔練習卡的關聯（SymptomPracticeMapping）。
        - **功能**：新增、編輯、刪除症狀與練習卡的關聯。
        - **驗證邏輯**：在編輯症狀的練習卡關聯時，檢查該症狀關聯的練習卡總數；若不足 3 張或超過 5 張，返回提示訊息 `{ "warning": "該症狀目前關聯 X 張練習卡，建議 3-5 張", "allowed": true }` 但允許保存。
        - **回傳格式**：成功時返回更新後的症狀及其關聯練習卡列表。
    -   [x] **API-205.4**：提供 CRUD 接口用於管理同義詞庫（症狀別名）。

## 2.5 RAG 相關任務 (RAG Related Tasks)

-   [x] **RAG-251**：建立 RAG 知識來源的預處理流程（清洗、分段）。
    -   [x] **RAG-251.1**：開發教練答覆資料清洗腳本（移除格式化符號、正規化日期、標準化單位）。
    -   [x] **RAG-251.2**：開發影片逐字稿清洗腳本（移除時間戳記、合併斷句、檢測語言）。
    -   [x] **RAG-251.3**：實現文本分段邏輯（基於句子或段落，保留上下文）。
-   [x] **RAG-252**：設計並實作向量資料庫或可檢索索引，用於儲存處理後的知識。
    -   [x] **RAG-252.1**：配置 ChromaDB 持久化存儲。
    -   [x] **RAG-252.2**：建立知識片段存儲結構（text、metadata、source、timestamps）。
    -   [x] **RAG-252.3**：開發知識導入腳本（從清洗後的教練答覆和影片逐字稿導入）。
-   [x] **RAG-253**：實作檢索機制，從知識庫中檢索與使用者問題最相關的知識片段。
    -   [x] **RAG-253.1**：使用 Sentence Transformers 進行向量化（多語言 MiniLM 模型）。
    -   [x] **RAG-253.2**：實現相似度搜尋（返回 Top-K 最相關的知識片段）。
    -   [x] **RAG-253.3**：實現混合搜尋機制（向量相似度 + 關鍵詞匹配）。
-   [x] **RAG-254**：實作生成機制，將檢索出的知識片段與使用者問題結合，形成優化後的提示詞。
    -   [x] **RAG-254.1**：設計提示詞模板（包含症狀辨識、練習卡生成、追問邏輯三個場景）。
    -   [x] **RAG-254.2**：實現上下文組裝邏輯（將 RAG 檢索結果、使用者輸入、Slot 資訊組合）。
    -   [x] **RAG-254.3**：實現提示詞優化機制（長度控制、關鍵資訊優先級）。
-   [x] **RAG-255**：整合大型語言模型 (LLM)，根據提示詞生成練習卡的內容。
    -   [x] **RAG-255.1**：選擇並配置 LLM API（如 OpenAI、Hugging Face、本地模型）。
    -   [x] **RAG-255.2**：實現練習卡內容生成（生成 goal、tips、pitfalls、dosage、self_check）。
    -   [x] **RAG-255.3**：實現症狀辨識輔助（讓 LLM 根據使用者輸入和 RAG 檢索結果判斷症狀）。
    -   [x] **RAG-255.4**：實現追問建議生成（讓 LLM 根據置信度判斷是否需要追問及生成追問問題）。

## 2.6 資料提取與處理任務 (Data Extraction & Processing Tasks)

-   [x] **DM-250**：建立從教練答覆中自動提取症狀描述和練習建議的流程。
    -   [x] **DM-250.1**：開發症狀抽取腳本（使用規則和 NLP 識別症狀關鍵詞和描述）。
    -   [x] **DM-250.2**：開發練習建議抽取腳本（識別動作要點、常見錯誤、建議次數）。
    -   [x] **DM-250.3**：建立結構化知識表示（症狀 → 原因 → 練習方案的對應關係）。
    -   [x] **DM-250.4**：實現人工審核機制（將自動抽取結果標記為待審核，管理者可人工確認）。

## 2.7 資料清洗工具集任務 (Data Preparation Toolkit Tasks)

**工具位置**：`/tools/data_preparation/` - 獨立於主應用的資料處理工具

-   [x] **TOOL-101**：開發逐字稿清洗 CLI 工具。
    -   [x] **TOOL-101.1**：支援 .txt 和 .md 文本檔清洗（移除雜訊、正規化格式、檢測語言）。
    -   [x] **TOOL-101.2**：實現分段邏輯（按段落或句子分割，保留足夠上下文以供知識抽取）。
    -   [x] **TOOL-101.3**：生成清洗後的中間格式（JSON with metadata: source, timestamp, language）。
    -   [x] **TOOL-101.4**：支援批量處理（輸入整個資料夾，輸出對應的清洗結果）。

-   [x] **TOOL-102**：開發知識自動抽取工具。
    -   [x] **TOOL-102.1**：基於關鍵詞和規則的症狀抽取（識別「後坐」、「重心」等症狀詞彙及其上下文）。
    -   [x] **TOOL-102.2**：基於結構的練習建議抽取（識別「動作要點」、「常見錯誤」、「建議次數」等模式）。
    -   [x] **TOOL-102.3**：生成候選知識片段（JSON format with fields: symptom, practice_tips, pitfalls, dosage, source_snippet）。
    -   [x] **TOOL-102.4**：標記為「待審核」狀態（便於人工驗證）。

-   [x] **TOOL-103**：開發資料驗證與品質檢查工具。
    -   [x] **TOOL-103.1**：檢查症狀名稱唯一性和格式一致性。
    -   [x] **TOOL-103.2**：驗證練習建議的完整性（是否包含 goal、tips、pitfalls、dosage、self_check）。
    -   [x] **TOOL-103.3**：生成驗證報告，標記異常記錄（缺少字段、過短描述等）。

-   [x] **TOOL-104**：開發簡易人工審核 Web 介面。
    -   [x] **TOOL-104.1**：展示待審核的知識片段（症狀與練習建議）。
    -   [x] **TOOL-104.2**：支援修改和確認（允許管理者調整自動抽取的結果）。
    -   [x] **TOOL-104.3**：支援批量操作（批准多個片段、標記為不適用等）。
    -   [x] **TOOL-104.4**：導出審核結果為 JSON（用於導入 ChromaDB）。

-   [x] **TOOL-105**：開發知識庫導入工具。
    -   [x] **TOOL-105.1**：將審核後的知識片段轉換為向量格式（使用 Sentence Transformers）。
    -   [x] **TOOL-105.2**：批量導入到 ChromaDB（包含 metadata: source, snippet_id, last_updated）。
    -   [x] **TOOL-105.3**：驗證導入成功（檢查向量化是否完成、是否可檢索）。
    -   [x] **TOOL-105.4**：生成導入報告（導入數量、耗時、任何錯誤）。

-   [x] **TOOL-106**：開發 CLI 主入口點與執行流程。
    -   [x] **TOOL-106.1**：實現 `python cli.py clean --input ./data_in --output ./data_out` 命令。
    -   [x] **TOOL-106.2**：實現 `python cli.py extract --input ./data_out --review-mode` 命令（進入人工審核模式）。
    -   [x] **TOOL-106.3**：實現 `python cli.py validate --input ./data_out` 命令（驗證資料品質）。
    -   [x] **TOOL-106.4**：實現 `python cli.py import --input ./data_out --chroma-db-path ./backend/chroma_db` 命令。
    -   [x] **TOOL-106.5**：編寫清晰的 README.md 和使用範例。

-   [x] **TOOL-107**：應用側的知識庫管理 API（與工具相互配合）。
    -   [x] **TOOL-107.1**：提供 `/api/v1/knowledge/upload` 端點，接收清洗後的 JSON 檔案（供工具上傳）。
    -   [x] **TOOL-107.2**：提供 `/api/v1/knowledge/list-pending-review` 端點，列出待審核項目。
    -   [x] **TOOL-107.3**：提供 `/api/v1/knowledge/approve` 和 `/api/v1/knowledge/reject` 端點，進行審核操作。
    -   [x] **TOOL-107.4**：提供 `/api/v1/knowledge/export` 端點，導出已批准的知識片段為 JSON（用工具導入 ChromaDB）。

## 3. 前端介面層任務 (Frontend UI Layer Tasks)

-   [x] **UI-300**：設計並實作首頁與導航架構。
    -   [x] **UI-300.1**：首頁（Dashboard）- 顯示使用者歡迎信息、最近的練習會話、快速操作按鈕。
    -   [x] **UI-300.2**：導航菜單 - 支援「首頁」、「我的問題」、「我的練習」、「設定」等頁面導航。
    -   [x] **UI-300.3**：回應式設計 - 適配行動裝置、平板、桌面螢幕。

-   [x] **UI-301**：設計並實作使用者輸入介面（「我的問題」頁面）。
    -   [x] **UI-301.1**：文字框用於輸入口語問題（至少支援 200 字）。
    -   [x] **UI-301.2**：選擇介面用於選填資訊（等級、地形、風格）。
    -   [x] **UI-301.3**：提交按鈕，點擊後調用後端 API 進行症狀辨識。
    -   [x] **UI-301.4**：顯示加載狀態與進度指示。

-   [x] **UI-302**：設計並實作自適應追問介面。
    -   [x] **UI-302.1**：當系統需要追問時，顯示 1-2 個追問問題。
    -   [x] **UI-302.2**：提供清晰的選項或輸入框供使用者回答。
    -   [x] **UI-302.3**：追問後自動跳轉至建議頁面。

-   [x] **UI-303**：設計並實作練習卡展示介面（「我的練習 - 系統建議」頁面）。
    -   [x] **UI-303.1**：列表/卡片視圖展示 3-5 張練習卡，按照關聯性分數排序。
    -   [x] **UI-303.2**：練習卡詳細內容展示（名稱、目標、要點、常見錯誤、建議次數、自我檢查點）。
    -   [x] **UI-303.3**：根據練習卡 `card_type` 展示不同格式（例如滑雪與單板滑雪可能有不同的卡片佈局）。
    -   [x] **UI-303.4**：展示「練習卡數量提示」（如「找到 X 張練習卡，建議至少 3 張」或「共 X 張，已顯示排名前 5 張」）。

-   [x] **UI-304**：設計並實作練習卡詳細頁面（「我的練習 - 詳細」）。
    -   [x] **UI-304.1**：完整展示練習卡內容（包括進度條、多個要點項目、展開/摺疊的常見錯誤修正）。
    -   [x] **UI-304.2**：互動式要點檢查清單（可勾選已掌握的要點）。
    -   [x] **UI-304.3**：自我檢查點清單（標記需改進的項目，使用橘色 checkbox）。
    -   [x] **UI-304.4**：★ 加入最愛按鈕（顯示在卡片上方，點擊時切換填充/空心星）。
    -   [x] **UI-304.5**：多層回饋界面（見 UI-307 詳細描述）。

-   [x] **UI-305**：設計並實作練習歷史頁面（「我的練習 - 歷史記錄」）。
    -   [x] **UI-305.1**：按日期倒序展示所有過去的練習會話。
    -   [x] **UI-305.2**：展示會話資訊（日期、症狀描述、推薦卡片數量、使用者回饋狀態）。
    -   [x] **UI-305.3**：支援篩選和搜尋（按等級、地形、日期範圍等）。
    -   [x] **UI-305.4**：點擊可重新查看該會話的推薦練習卡。

-   [x] **UI-306**：設計並實作設定頁面（「設定」）。
    -   [x] **UI-306.1**：使用者偏好設定（預設等級、地形、滑行風格）。
    -   [x] **UI-306.2**：帳號資訊（如適用）。
    -   [x] **UI-306.3**：應用程式設定（深淺色主題、語言等）。

-   [x] **UI-307**：設計並實作多層回饋介面。

    **回饋層一：對整個問題推薦流程的效果評價**
    -   [x] **UI-307.1.1**：在推薦結果頁面底部提供「這些練習卡有幫助嗎？」問卷區塊。
        - **即時回饋**：用戶收到推薦後，可直接評價
        - **選項**：三個大卡片，顯示 Emoji + 文字（❌ 不適用 / △ 部分適用 / ✓ 適用）
        - **自由文字**：可選輸入框補充意見
    -   [x] **UI-307.1.2**：提供「稍後評價」選項，在歷史記錄中可回溯評價。
        - **延遲回饋機制**：用戶可在練習一段時間後回到會話進行評價

    **回饋層二：對單個練習卡的品質評價**
    -   [x] **UI-307.2.1**：在練習卡詳細頁面底部提供「這個練習卡對你有幫助嗎？」星數評分區塊。
        - **星數評分**：5 個可點擊的星數按鈕 (⭐ ⭐⭐ ⭐⭐⭐ ⭐⭐⭐⭐ ⭐⭐⭐⭐⭐)
        - **星數含義**：
          - 1★ = 不適用 (練習卡與我的症狀無關)
          - 2★ = 較不適用 (部分內容有用)
          - 3★ = 部分適用 (有幫助但需要調整)
          - 4★ = 適用 (相當有幫助)
          - 5★ = 非常適用 (完全符合我的需求)
        - **選中反饋**：點擊星數後顯示對應含義（例如「你評分了 4 顆星 - 適用」）
        - **自由文字**：可選輸入框補充意見
        - **加入最愛**：在評分下方提供「❤️ 加入最愛練習清單」按鈕，可獨立於星數設定
    -   [x] **UI-307.2.2**：支援隨時修改星數評價（用戶可重新點擊星數更新評分，無需重新提交全部數據）。
    -   [x] **UI-307.2.3**：支援獨立管理最愛狀態（已加入最愛的卡片可修改星數而不影響最愛標記，反之亦然）。
    -   [x] **UI-307.3**：提交回饋後顯示確認訊息。

-   [x] **UI-308**：設計並實作管理者後台介面。
    -   [x] **UI-308.1**：症狀管理頁面 - 提供 CRUD 介面用於管理症狀種子。
        - 展示症狀列表（名稱、類別、適用範圍）。
        - 編輯症狀時，顯示關聯的練習卡數量與提示「建議 3-5 張」。
    -   [x] **UI-308.2**：練習卡管理頁面 - 提供 CRUD 介面用於管理練習卡。
        - 編輯練習卡時，顯示該卡被關聯的症狀列表。
    -   [x] **UI-308.3**：症狀↔練習卡關聯管理頁面。
        - 以表格或網狀視圖展示症狀與練習卡的多對多關聯。
        - 新增/刪除關聯時驗證並提示「建議 3-5 張」。
    -   [x] **UI-308.4**：同義詞庫管理頁面 - 提供 CRUD 介面用於管理症狀別名。
    -   [x] **UI-308.5**：基礎的使用者認證與角色控制（僅管理者可訪問）。
    -   [x] **UI-308.6**：回饋分析儀表板 - 整體統計與概覽。
        - **層一分析**（Session 層級）：
          - 推薦流程評分分布（❌/△/✓ 比例）
          - 即時回饋 vs 延遲回饋的比例
          - 過去 7/30/90 天的趨勢圖表
        - **層二分析**（PracticeCard 層級）：
          - 星數分布（1-5★ 的比例）
          - 平均星數排名（Top 10 最高評分卡片）
          - 最愛次數排名
        - **對比分析**：
          - 層一評分 vs 層二星數的關聯性
          - 用戶流漏（推薦後有多少人評分）
    -   [x] **UI-308.7**：練習卡回饋詳情頁 - 深入分析單張練習卡。
        - 顯示該卡的所有評分記錄（按時間倒序）
        - 星數分布圖表（柱狀圖或餅圖）
        - 平均星數、評分總數、最愛次數
        - 用戶反饋文本摘要（自由文字評論）
        - 建議改進清單（從低星評分提取的常見問題）
        - 操作按鈕：編輯卡片、創建改進版本
    -   [x] **UI-308.8**：症狀回饋分析頁 - 了解症狀推薦的有效性。
        - 顯示該症狀的所有推薦會話
        - 會話層級評分分布（❌/△/✓）
        - 關聯的練習卡及其星數排名
        - 識別高效卡片（平均 4★+ 且最愛率 > 50%）
        - 識別問題卡片（平均 < 2★ 或最愛率 < 10%）
    -   [x] **UI-308.9**：用戶偏好分析頁 - 了解用戶的練習習慣。
        - 高評分練習卡排名（按平均星數）
        - 最常被加入最愛的卡片
        - 用戶段落分析（初級/中級/高級用戶的偏好差異）
        - 地形/風格偏好分析（不同條件下的推薦有效性）
    -   [x] **UI-308.10**：數據導出與報告 - 支援管理員下載分析數據。
        - 導出格式：CSV / Excel / PDF 報告
        - 導出範圍：時間段篩選、症狀篩選、卡片篩選
        - 預設報告模板（週報、月報、季報）

-   [x] **UI-309**：設計並實作最愛練習清單頁面（「我的練習 - 最愛」）。
    -   [x] **UI-309.1**：顯示使用者標記為最愛的所有練習卡。
        - 卡片展示（含練習卡名稱、簡要描述、用戶給予的星數評分、評分時的備註）。
        - 按標記時間倒序排列。
        - 顯示上次練習時間（如有）。
    -   [x] **UI-309.2**：快速操作功能。
        - **開始練習**：點擊直接進入練習卡詳細頁面。
        - **移除最愛**：取消最愛標記（點擊 ❤️ 按鈕）。
        - **修改評分**：快速重新評分（顯示當前星數，允許點擊修改）。
        - **查看詳情**：顯示完整的練習卡內容和評分備註。
    -   [x] **UI-309.3**：空狀態處理（未有最愛練習卡時的提示「還沒有加入任何最愛練習卡」）。
    -   [x] **UI-309.4**：集成到主導航菜單（「我的練習」 → 「最愛」標籤或子菜單）。

-   [x] **API-206**：開發「最愛清單管理」API。
    -   [x] **API-206.1**：提供 GET 接口列出用戶的所有最愛練習卡（含評分和備註）。
    -   [x] **API-206.2**：提供 POST/PUT 接口更新練習卡的最愛狀態。
    -   [x] **API-206.3**：提供 DELETE 接口移除最愛標記。

-   [x] **API-207**：開發「回饋分析」API（管理員專用）。

    **整體統計端點**
    -   [x] **API-207.1**：GET `/api/v1/admin/feedback-analytics/summary` - 整體回饋統計。
        - **層一統計**：
          - `session_feedback_distribution`: { not_applicable: 12, partially_applicable: 45, applicable: 78 }
          - `immediate_vs_delayed`: { immediate: 80, delayed: 55 }
          - `feedback_completion_rate`: 0.68 (評分人數 / 總推薦人數)
          - `trend_7d`: 過去 7 天按日的評分數量
        - **層二統計**：
          - `rating_distribution`: { 1: 10, 2: 15, 3: 45, 4: 78, 5: 52 }
          - `average_rating`: 3.8
          - `favorite_count`: 156
          - `favorite_rate`: 0.32 (最愛數 / 總評分數)
        - **對比分析**：
          - `feedback_correlation`: 層一評分與層二星數的相關性係數
          - `top_cards_by_rating`: 前 10 個最高評分卡片

    **練習卡回饋端點**
    -   [x] **API-207.2**：GET `/api/v1/admin/feedback-analytics/practice-cards/{practice_id}` - 單張卡片的詳細分析。
        - `card_info`: { id, name, avg_rating, rating_count }
        - `rating_distribution`: { 1: ..., 2: ..., 3: ..., 4: ..., 5: ... }
        - `rating_trend`: 過去 30 天的星數趨勢
        - `favorite_count` 及 `favorite_rate`
        - `feedback_comments`: 用戶反饋文本摘要 (Top 5 最常出現的詞彙/短語)
        - `improvement_suggestions`: 從低星評分 (1-2★) 提取的改進建議
        - `related_sessions`: 最近 10 個評分記錄（含用戶、時間、星數、備註）

    **症狀回饋端點**
    -   [x] **API-207.3**：GET `/api/v1/admin/feedback-analytics/symptoms/{symptom_id}` - 單個症狀的推薦有效性。
        - `symptom_info`: { id, name, category }
        - `session_feedback_distribution`: 層一評分分布
        - `related_cards_analysis`:
          ```
          [
            {
              practice_id: 123,
              card_name: "...",
              avg_rating: 4.5,
              rating_count: 45,
              favorite_count: 28,
              effectiveness_score: 0.92  // (4★+ 的人數 / 總人數)
            }
          ]
          ```
        - `high_performers`: 平均 4★+ 且最愛率 > 50% 的卡片
        - `low_performers`: 平均 < 2★ 或最愛率 < 10% 的卡片
        - `session_trend`: 過去 30 天的推薦有效性趨勢

    **用戶偏好分析端點**
    -   [x] **API-207.4**：GET `/api/v1/admin/feedback-analytics/user-preferences` - 整體用戶偏好分析。
        - `top_rated_cards`: 前 20 個平均星數最高的卡片
        - `most_favorited_cards`: 前 20 個最常被加入最愛的卡片
        - `user_segment_analysis`:
          ```
          {
            beginner: { avg_rating: 3.6, favorite_rate: 0.28, top_cards: [...] },
            intermediate: { avg_rating: 3.9, favorite_rate: 0.35, top_cards: [...] },
            advanced: { avg_rating: 4.1, favorite_rate: 0.42, top_cards: [...] }
          }
          ```
        - `terrain_preference`: 不同地形用戶的偏好卡片
        - `style_preference`: 不同滑行風格用戶的偏好卡片

    **篩選與時間段端點**
    -   [x] **API-207.5**：GET `/api/v1/admin/feedback-analytics/filtered` - 支援多條件篩選的統計。
        - **查詢參數**：
          - `start_date`: YYYY-MM-DD
          - `end_date`: YYYY-MM-DD
          - `symptom_ids`: 逗號分隔的症狀 ID (可選，篩選特定症狀)
          - `practice_ids`: 逗號分隔的練習卡 ID (可選)
          - `rating_min` / `rating_max`: 星數範圍篩選 (可選)
          - `feedback_type`: immediate / delayed (可選)
          - `sort_by`: rating_desc / favorite_desc / date_desc
        - 返回經篩選的統計結果

    **數據導出端點**
    -   [x] **API-207.6**：POST `/api/v1/admin/feedback-analytics/export` - 導出分析數據。
        - **請求體**：
          ```json
          {
            "format": "csv",  // csv / excel / pdf
            "report_type": "summary",  // summary / practice_details / symptom_details / user_preferences
            "start_date": "2025-10-01",
            "end_date": "2025-10-28",
            "include_comments": true
          }
          ```
        - 返回下載鏈接或流式返回檔案

## 4. 測試任務 (Testing Tasks)

-   [x] **TEST-401**：根據 `spec/features/輸入.feature` 編寫自動化測試。
-   [x] **TEST-402**：根據 `spec/features/自適應追問.feature` 編寫自動化測試。
-   [x] **TEST-403**：根據 `spec/features/症狀辨識.feature` 編寫自動化測試。
-   [x] **TEST-404**：根據 `spec/features/建議生成.feature` 編寫自動化測試。
-   [x] **TEST-405**：根據 `spec/features/使用者回饋.feature` 編寫自動化測試。
-   [x] **TEST-406**：編寫管理後台回饋分析系統的測試。
    -   [x] **TEST-406.1**：API-207.1 (整體統計摘要) 單元測試。
        - 驗證層一、層二統計計算正確
        - 驗證對比分析（相關性係數）正確
        - 驗證趨勢數據完整
    -   [x] **TEST-406.2**：API-207.2 (練習卡詳情分析) 單元測試。
        - 驗證星數分布計算正確
        - 驗證改進建議提取正確
        - 驗證用戶反饋文本摘要生成
    -   [x] **TEST-406.3**：API-207.3 (症狀有效性分析) 單元測試。
        - 驗證推薦有效率計算正確
        - 驗證高效/低效卡片識別正確
        - 驗證趨勢分析完整
    -   [x] **TEST-406.4**：API-207.4 (用戶偏好分析) 單元測試。
        - 驗證用戶段落分析（初級/中級/進階）
        - 驗證地形和風格偏好分析
        - 驻驗證 Top N 排名正確
    -   [x] **TEST-406.5**：API-207.5 (篩選與多條件查詢) 單元測試。
        - 驗證時間段篩選
        - 驗證症狀和卡片 ID 篩選
        - 驗證星數範圍篩選
        - 驗證排序邏輯
    -   [x] **TEST-406.6**：API-207.6 (數據導出) 單元測試。
        - 驗證 CSV 導出格式正確
        - 驗證 Excel 導出可用性
        - 驗證 PDF 報告生成
        - 驗證大數據導出性能 (10K+ 記錄)
    -   [x] **TEST-406.7**：UI-308 回饋分析界面集成測試。
        - 儀表板 (UI-308.6) 圖表渲染正確
        - 卡片詳情頁 (UI-308.7) 數據完整
        - 症狀分析頁 (UI-308.8) 操作流暢
        - 用戶偏好頁 (UI-308.9) 多維度切換正確
        - 導出功能 (UI-308.10) 可用

## 5. 文件與規範 (Documentation & Standards)

-   [x] **DOC-501**：持續參考 `prompt/Glossary.md` 確保術語一致性。
-   [x] **DOC-502**：根據選擇的技術方案更新開發環境設定指南 (`dev-setup.md`)。
-   [x] **DOC-503**：建立程式碼風格和架構模式指引，確保六邊形架構的一致實施。

## 6. 開發環境與部署 (Development Environment & Deployment)

-   [x] **DEV-601**：設定 Python 開發環境 (Python 3.9+, FastAPI, SQLAlchemy, ChromaDB)。
-   [x] **DEV-602**：設定前端開發環境 (Node.js, React, TypeScript)。
-   [x] **DEV-603**：設定資料庫遷移工具 (Alembic)。
-   [x] **DEV-604**：建立專案配置和環境變數管理。
-   [x] **DEV-605**：設定容器化部署方案 (Docker/Docker Compose)。
-   [x] **DEV-606**：建立 CI/CD 初始設置。
-   [x] **DEV-607**：建立 Vercel 前端部署配置。
-   [x] **DEV-608**：建立 Vercel Functions 後端部署配置。
-   [x] **DEV-609**：設定 Supabase 資料庫服務。
-   [x] **DEV-610**：設定 Vercel Analytics 監控。
-   [x] **DEV-611**：設定 API 健康檢查端點。

## 7. 安全與效能優化 (Security & Performance Optimization)
-   [x] **OPT-701**：實施輸入驗證與清理機制。
-   [x] **OPT-702**：設定 API 速率限制。
-   [x] **OPT-703**：優化向量搜尋效能。
-   [x] **OPT-704**：設定適當的快取機制。
-   [x] **OPT-705**：實現模型量化以減少模型大小和推理時間。
-   [x] **OPT-706**：實現模型快取機制，預載模型到記憶體。
-   [x] **OPT-707**：建立同義詞詞彙庫並優化匹配效能。
-   [x] **OPT-708**：預計算常見症狀和練習卡的向量表示。

## 8. 安全措施 (Security Measures)
-   [x] **SEC-801**：實現輸入驗證與清理機制，使用 Pydantic 進行資料驗證。
-   [x] **SEC-802**：實施 API 速率限制，防止濫用和 DDoS 攻擊。
-   [x] **SEC-803**：實現提示詞注入防護機制。
-   [x] **SEC-804**：建立內容過濾機制，防止不當內容產生。
-   [x] **SEC-805**：設定資料加密 (TLS/SSL) 和敏感資訊保護。
-   [x] **SEC-806**：實施 API 金鑰管理和輪換機制。

## 9. 測試策略 (Testing Strategy)
-   [x] **TST-901**：建立單元測試框架，為核心業務邏輯實施 TDD。
-   [x] **TST-902**：實現整合測試，測試組件間的協作。
-   [x] **TST-903**：建立端到端測試，測試完整使用者流程。
-   [x] **TST-904**：建立 AI 模型準確性測試基準。
-   [x] **TST-905**：實現效能測試，確保 P95 響應時間 < 2.5s。
-   [x] **TST-906**：建立安全性測試套件。
-   [x] **TST-907**：設定測試代碼覆蓋率檢查。

## 10. 資料管理 (Data Management)
-   [x] **DM-1001**：建立從影片逐字稿自動提取症狀描述的流程。
-   [x] **DM-1002**：建立從影片逐字稿自動提取練習建議的流程。
-   [x] **DM-1003**：實現症狀與練習卡的結構化對應關係建立。
-   [x] **DM-1004**：建立知識庫自動化維護流程。
-   [x] **DM-1005**：實現版本控制與回滾機制。
-   [x] **DM-1006**：建立品質控制與人工審核機制。
-   [x] **DM-1007**：整合使用者回饋到知識庫。

## 11. 錯誤處理與彈性設計 (Error Handling & Resilience)
-   [x] **ER-1101**：實施熔斷器模式，防止級聯故障。
-   [x] **ER-1102**：實現重試邏輯和指數退避策略。
-   [x] **ER-1103**：建立降級策略，提供「最安全基礎練習組」。
-   [x] **ER-1104**：實現 AI 服務不可用時的備用方案。
-   [x] **ER-1105**：建立系統監控和錯誤追蹤機制。
-   [x] **ER-1106**：設定錯誤率和響應時間告警。

## 12. 使用者體驗優化 (User Experience Optimization)
-   [x] **UX-1201**：實現回應式設計，適應不同裝置尺寸。
-   [x] **UX-1202**：設計智慧提示與自動完成功能。
-   [x] **UX-1203**：優化觸控介面，考慮行動裝置使用場景。
-   [x] **UX-1204**：實施資料預載與快取機制以優化效能。
-   [x] **UX-1205**：提供首次使用導覽。
-   [x] **UX-1206**：設計清晰的錯誤訊息和進度指示器。
-   [x] **UX-1207**：簡化選填資訊流程，提供預設選項。

## 13. 分析與回饋系統 (Analytics & Feedback System)
-   [x] **AN-1301**：實現使用者行為追蹤，記錄症狀描述和練習卡選擇。
-   [x] **AN-1302**：建立系統效能監控機制。
-   [x] **AN-1303**：實現回饋收集與分析功能。
-   [x] **AN-1304**：建立使用者評價（👍/👎）追蹤系統。
-   [x] **AN-1305**：分析回饋內容以改進系統。

## 14. 維護與營運 (Maintenance & Operations)
-   [x] **MO-1401**：設定自動化測試與部署流程 (CI/CD)。
-   [x] **MO-1402**：實現版本控制和發布管理。
-   [x] **MO-1403**：建立回滾機制。
-   [x] **MO-1404**：定期更新依賴套件。
-   [x] **MO-1405**：實施系統安全更新流程。
-   [x] **MO-1406**：實現核心功能回歸測試。
-   [x] **MO-1407**：建立 AI 模型準確性驗證流程。

## 15. 專案基礎建設 (Project Infrastructure)
-   [x] **INF-1501**：建立專案根目錄結構與基本配置文件。
-   [x] **INF-1502**：設定 Docker 容器化部署方案。
-   [x] **INF-1503**：建立 CI/CD 配置文件。
-   [x] **INF-1504**：撰寫專案說明文件 (README.md)。
-   [x] **INF-1505**：建立貢獻指南 (CONTRIBUTING.md)。

## 16. 架構簡化與優化 (Architecture Simplification & Optimization)
-   [x] **SIM-1601**：簡化後端實現層，使用簡單函數替代複雜代理模式。
-   [x] **SIM-1602**：優化數據模型，使用字典而非複雜 Pydantic 模型。
-   [x] **SIM-1603**：簡化服務層實現，消除不必要的抽象層。
-   [x] **SIM-1604**：優化 API 路由，保持接口不變的前提下簡化實現。
-   [x] **SIM-1605**：驗證簡化後實現的兼容性，確保所有現有功能正常運行。

## 17. 簡化實現驗證 (Simplified Implementation Validation)
-   [x] **VAL-1701**：驗證簡化後架構的性能提升效果。
-   [x] **VAL-1702**：驗證簡化後實現的代碼可讀性改善。
-   [x] **VAL-1703**：驗證簡化後實現的維護性提升。
-   [x] **VAL-1704**：驗證簡化後實現的向後兼容性。
-   [x] **VAL-1705**：驗證簡化後實現的錯誤處理機制。

## 16. AI 模型管理 (AI Model Management)
-   [x] **AI-1601**：選擇並配置多語言支援的嵌入模型 (paraphrase-multilingual-MiniLM-L12-v2)。
-   [x] **AI-1602**：建立模型效能評估基準。
-   [x] **AI-1603**：實現模型更新和版本管理機制。

## 18. 用戶體驗優化 (User Experience Enhancements)

### 🔴 優先級 P1：立即實施（用戶粘性爆表）

-   [x] **UXP-1801**：練習成功率追蹤 ⭐
    -   [x] **UXP-1801.1**：首頁添加進度卡片，顯示週練習次數、上週對比、連續天數。
    -   [x] **UXP-1801.2**：後端實現 session 計數和評分對比邏輯。
    -   [x] **UXP-1801.3**：前端設計進度卡片 UI 組件。
    -   **實施難度**：⭐ | **預計時間**：< 4 小時 | **預期影響**：🔥🔥🔥 日活 +40-50%

-   [x] **UXP-1802**：推薦理由說明 ⭐
    -   [x] **UXP-1802.1**：練習卡展示時添加「為什麼推薦這個？」區塊。
    -   [x] **UXP-1802.2**：顯示推薦理由：針對症狀、適合等級、其他用戶評分、預期效果。
    -   [x] **UXP-1802.3**：後端組裝推薦理由返回邏輯（數據已有，需組裝）。
    -   [x] **UXP-1802.4**：前端卡片上添加說明展示區域。
    -   **實施難度**：⭐ | **預計時間**：< 2 小時 | **預期影響**：🔥🔥🔥 新用戶信任度 +35%

-   [x] **UXP-1803**：離線查看練習卡 ⭐⭐
    -   [x] **UXP-1803.1**：配置前端 Service Worker 進行內容緩存。
    -   [x] **UXP-1803.2**：首屏加載後自動下載推薦卡片到本地。
    -   [x] **UXP-1803.3**：優先下載最愛列表中的卡片。
    -   [x] **UXP-1803.4**：在卡片上顯示「可離線查看 ✓」標記。
    -   **實施難度**：⭐⭐ | **預計時間**：< 4 小時 | **預期影響**：🔥🔥 實用性大幅提升

### 🟠 優先級 P2：第一週實施（提升便利性）

-   [x] **UXP-1804**：快速重複上次查詢 ⭐
    -   [x] **UXP-1804.1**：後端存儲用戶上次查詢 session（symptom、level、terrain、style）。
    -   [x] **UXP-1804.2**：首頁添加「快速開始」區塊，顯示上次查詢內容。
    -   [x] **UXP-1804.3**：添加「重複上次查詢」按鈕，點擊直接展示結果。
    -   **實施難度**：⭐ | **預計時間**：< 1 小時 | **預期影響**：🔥🔥 應用使用頻次 +50%

-   [x] **UXP-1805**：練習卡難度視覺化 ⭐
    -   [x] **UXP-1805.1**：每張卡片上顯示難度指示器（進度條或圖標）。
    -   [x] **UXP-1805.2**：使用清晰的視覺層級：🟢 初級 / 🟡 中級 / 🔴 進階。
    -   [x] **UXP-1805.3**：確保難度評級在數據庫中已存在（後端確認）。
    -   **實施難度**：⭐ | **預計時間**：< 1 小時 | **預期影響**：🔥 用戶能根據體力選擇

-   [x] **UXP-1806**：成功/失敗後的視覺反饋 ⭐
    -   [x] **UXP-1806.1**：用戶評分後顯示動畫確認界面。
    -   [x] **UXP-1806.2**：顯示鼓勵訊息：「感謝你的評分，幫助其他 X 位用戶」。
    -   [x] **UXP-1806.3**：顯示進度更新：堅持天數、改善指標（4★ → 5★）。
    -   [x] **UXP-1806.4**：後端計算累積幫助的人數邏輯。
    -   **實施難度**：⭐ | **預計時間**：< 2 小時 | **預期影響**：🔥🔥 滿足感提升

-   [x] **UXP-1807**：最愛卡片的快速入口 ⭐
    -   [x] **UXP-1807.1**：首頁添加「❤️ 我的最愛」區塊，顯示最近加入的最愛卡片。
    -   [x] **UXP-1807.2**：支援水平滾動或列表展示最愛卡片。
    -   [x] **UXP-1807.3**：點擊可直接進入卡片詳細頁面。
    -   [x] **UXP-1807.4**：添加「查看全部」鏈接到完整最愛列表。
    -   **實施難度**：⭐ | **預計時間**：< 2 小時 | **預期影響**：🔥🔥 摩擦力減少 +40%

### 🟡 優先級 P3：第二週實施（增強體驗）

-   [x] **UXP-1808**：連續練習激勵 ⭐⭐
    -   [x] **UXP-1808.1**：後端計算用戶連續練習的天數。
    -   [x] **UXP-1808.2**：前端顯示「🔥 連續 X 天」計數器。
    -   [x] **UXP-1808.3**：設定里程碑：7 天、30 天、100 天，對應勳章。
    -   [x] **UXP-1808.4**：達到里程碑時顯示特殊反饋：「恭喜！你已超越 X% 的用戶」。
    -   **實施難度**：⭐ | **預計時間**：< 3 小時 | **預期影響**：🔥🔥🔥 留存率大幅提升

-   [x] **UXP-1809**：練習時間提醒 ⭐⭐
    -   [x] **UXP-1809.1**：設定頁面添加「⏰ 練習提醒設置」區塊。
    -   [x] **UXP-1809.2**：支援選擇提醒頻率（每天上午/下午/晚上，或自訂時間）。
    -   [x] **UXP-1809.3**：支援多種提醒方式（推播通知、郵件）。
    -   [x] **UXP-1809.4**：後端實現提醒計時邏輯和推播發送。
    -   **實施難度**：⭐⭐ | **預計時間**：< 5 小時 | **預期影響**：🔥🔥 習慣養成效果

-   [x] **UXP-1810**：症狀改善評估 ⭐⭐
    -   [x] **UXP-1810.1**：每 2 周後自動提示進行「進度評估」。
    -   [x] **UXP-1810.2**：顯示評估表單：「你的『症狀名』現在改善了嗎？」。
    -   [x] **UXP-1810.3**：提供選項：明顯改善 / 有所改善 / 沒有改善 / 反而惡化。
    -   [x] **UXP-1810.4**：根據評估結果動態建議：繼續練習、替代卡片或停止。
    -   **實施難度**：⭐⭐ | **預計時間**：< 4 小時 | **預期影響**：🔥🔥 用戶追蹤感

### 🟢 優先級 P4：第三週實施（增加趣味）

-   [x] **UXP-1811**：社群信任指標 ⭐
    -   [x] **UXP-1811.1**：在推薦卡片上顯示社群反饋：「⭐⭐⭐⭐⭐ 4.6 分 (28 位用戶評分)」。
    -   [x] **UXP-1811.2**：顯示有幫助的比例：「96% 用戶認為有幫助」。
    -   [x] **UXP-1811.3**：顯示用戶評論摘要（最多 2-3 條正面評論）。
    -   **實施難度**：⭐ | **預計時間**：< 2 小時 | **預期影響**：🔥 信任度提升

-   [x] **UXP-1812**：分享最愛卡片 ⭐
    -   [x] **UXP-1812.1**：在卡片上添加「分享」按鈕。
    -   [x] **UXP-1812.2**：支援分享方式：複製鏈接、WhatsApp、微信、生成二維碼。
    -   [x] **UXP-1812.3**：自動生成分享文案：「我在用 TurnFix 練習『症狀』，推薦這個練習卡！」。
    -   [x] **UXP-1812.4**：確保分享鏈接可正確打開卡片詳情。
    -   **實施難度**：⭐ | **預計時間**：< 3 小時 | **預期影響**：🔥🔥 口碑傳播

-   [x] **UXP-1813**：練習筆記功能 ⭐
    -   [x] **UXP-1813.1**：在練習卡詳細頁面底部添加「💭 我的練習筆記」區塊。
    -   [x] **UXP-1813.2**：支援自由文字輸入，自動保存。
    -   [x] **UXP-1813.3**：顯示筆記列表（按時間倒序），每條筆記含時間戳記。
    -   [x] **UXP-1813.4**：後端存儲和檢索筆記邏輯。
    -   **實施難度**：⭐ | **預計時間**：< 3 小時 | **預期影響**：🔥 個人化增強

### 💎 優先級 P5：進階優化（未來考慮）

-   [x] **UXP-1814**：個人化推薦演化 ⭐⭐
    -   [x] **UXP-1814.1**：根據用戶評分歷史，識別用戶偏好的卡片類型。
    -   [x] **UXP-1814.2**：顯示推薦訊息：「你上次喜歡『轉彎技巧基礎』，可能也會喜歡『短轉練習』」。
    -   [x] **UXP-1814.3**：分析統計：「你最愛的卡片中，87% 是『轉彎』相關」。
    -   **實施難度**：⭐⭐ | **預計時間**：待評估

-   [x] **UXP-1815**：視頻示範鏈接 ⭐⭐
    -   [x] **UXP-1815.1**：如果 YouTube 有對應的示範視頻，自動推薦。
    -   [x] **UXP-1815.2**：在卡片上添加「[📺 查看示範視頻]」按鈕。
    -   [x] **UXP-1815.3**：支援視頻嵌入或連結跳轉。
    -   **實施難度**：⭐⭐ | **預計時間**：待評估

-   [x] **UXP-1816**：語音朗讀 ⭐⭐
    -   [x] **UXP-1816.1**：添加「[🔊 朗讀練習卡]」按鈕。
    -   [x] **UXP-1816.2**：使用文本轉語音 (TTS) 技術朗讀卡片內容。
    -   [x] **UXP-1816.3**：支援語言選擇（中文、英文等）。
    -   [x] **UXP-1816.4**：用戶可邊滑邊聽，無需看手機螢幕。
    -   **實施難度**：⭐⭐ | **預計時間**：待評估
